## Mysql 工作指南
---
### 1. 备份
在终端（请在mysql命令行之外，即退出mysql终端）运行：  
`mysqldump -uroot -proot --databases lol-mini > "C:\Users\Haip\Desktop\lol-mini.sql"`  
以上就是将名为lol-mini的数据库备份到桌面，并取名为lol-mini

### 2. 恢复
在mysql终端（恢复操作要在mysql终端内执行，备份则在外）运行：（可能要导入两次）  
`source C:\Users\Haip\Desktop\lol-mini.sql;`  
以上就是将桌面名为lol-mini.sql的数据库恢复到mysql中

### 3. 工作运用
以下是在 navicat 查询出结果后，导出：  

查询出番禺区8号和9号的全部来电：  
`SELECT id '序号',recordtime '录音时间',Telno '被叫分机号',CallerID '主叫号',Duration '呼入或呼出',Direction '录音时长',Fullname '录音文件名',department_code '部门' FROM record_list where department_code='PanYuCenter105' and (DATE(recordtime)='2024-07-08' or DATE(recordtime)='2024-07-09')`

查询出番禺区8号和9号的全部ivr轨迹：  
`SELECT id '序号',CallerID '主叫号',CalleeID '被叫分机号',ivr_time 'VIR轨迹时间',ivr_exten 'IVR轨迹',department_code '部门' FROM ivr_log_list where department_code='PanYuCenter105' and (DATE(ivr_time)='2024-07-08' or DATE(ivr_time)='2024-07-09')`

统计番禺区一个月的所有详情：
```
SELECT 
name '定位客户', CallerID '主叫号码', record_list.Telno '被叫号码',Direction '呼叫类型',recordtime '呼叫时间', 
IF(BridgeDatetime IS NOT NULL,1,NULL) '接听时间',
IF(BridgeDatetime IS NOT NULL, FORMAT(TIMEDIFF(STR_TO_DATE(CONCAT(DATE_FORMAT(HangupDatetime, '%Y-%m-%d %H:%i:%s')), '%Y-%m-%d %H:%i:%s.%f'), STR_TO_DATE(CONCAT(DATE_FORMAT(BridgeDatetime, '%Y-%m-%d %H:%i:%s')), '%Y-%m-%d %H:%i:%s.%f')), '%H:%i:%s'), NULL) '通话时长(s)',

IF(BridgeDatetime IS NOT NULL, FORMAT(TIMEDIFF(STR_TO_DATE(CONCAT(DATE_FORMAT(BridgeDatetime, '%Y-%m-%d %H:%i:%s')), '%Y-%m-%d %H:%i:%s.%f'), STR_TO_DATE(CONCAT(DATE_FORMAT(InsertDatetime, '%Y-%m-%d %H:%i:%s')), '%Y-%m-%d %H:%i:%s.%f')), '%H:%i:%s'), NULL) AS '振铃时长(s)',
CASE 
    WHEN CHAR_LENGTH(dial_state_list.DestExt) = 4 THEN Ext
    WHEN CHAR_LENGTH(dial_state_list.CallerIDNum) = 4 THEN CallerID
END AS '接听坐席',
CASE
		WHEN InsertDatetime IS NULL THEN 'IVR'
		WHEN BridgeDatetime IS NULL AND InsertDatetime IS NOT NULL THEN '振铃未接听'
		WHEN BridgeDatetime IS NOT NULL AND InsertDatetime IS NOT NULL THEN '已接听'
END AS '处理状态',
record_list.province AS '省份',
record_list.city AS '城市'
		
		
FROM record_list 
LEFT JOIN phonebook ON record_list.CallerID = phonebook.contact_phone 
LEFT JOIN dial_state_list ON record_list.UNIQUEID = dial_state_list.UNIQUEID 

WHERE department_code = 'PanYuCenter105' 
AND recordtime >= '2024-08-01 00:00:00'
AND recordtime <= '2024-08-31 23:59:59'
-- AND (name IS NULL OR name!= '')
ORDER BY recordtime DESC
```

### 其他
将主服务器的最新数据库发到备服务器   
```
scp /home/htdocs/IVRPhone/databases/IVRPhone_20240930.sql root@192.168.1.1:/home/htdocs/IVRPhone/databases/
```
